<mat-card class="header-container mat-elevation-z0">
  <span>My trips</span>
  <button mat-raised-button color="primary" (click)="redirectToCreateTrip()" [disabled]="isDisabled()">New trip</button>
</mat-card>
<mat-card class="list-container">
  <mat-table [dataSource]="tripsDataSource">
    <ng-container matColumnDef="admin" class="sibling">
      <mat-header-cell *matHeaderCellDef> Admin </mat-header-cell>
      <mat-cell *matCellDef="let trip"> 
        <div *ngIf="isCurrentUserAdmin(trip.admin);else other_content">
          <i class="material-icons">star</i>
        </div>
        <ng-template #other_content>{{trip.admin}}</ng-template>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="name">
      <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
      <mat-cell *matCellDef="let trip"> {{trip.name}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="participants">
      <mat-header-cell *matHeaderCellDef> Participants </mat-header-cell>
      <mat-cell *matCellDef="let trip"> {{trip.participants}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="status">
      <mat-header-cell *matHeaderCellDef> Status </mat-header-cell>
      <mat-cell *matCellDef="let trip">
        <div *ngIf="isUneditable(trip.id);else editStatus">{{trip.status}}</div>
        <ng-template #editStatus>
          <mat-form-field class="status-field">
            <select (click)="$event.stopPropagation()"  matNativeControl required [formControl]="status">
              <option value="{{trip.status}}">{{trip.status}}</option>
              <option value="{{getOtherStatus(trip.status)}}">{{getOtherStatus(trip.status)}}</option>
            </select>
          </mat-form-field>
        </ng-template>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="start_date">
      <mat-header-cell *matHeaderCellDef> Start Date </mat-header-cell>
      <mat-cell *matCellDef="let trip">
        <div *ngIf="isUneditable(trip.id);else other_content">{{trip.start_date}}</div>
        <ng-template #other_content>
          <mat-form-field class="date-field">
            <input matInput [matDatepicker]="picker1" [min] ="today" [formControl]="startDate">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1 ></mat-datepicker>
          </mat-form-field>
        </ng-template>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="end_date">
      <mat-header-cell *matHeaderCellDef> End Date </mat-header-cell>
      <mat-cell *matCellDef="let trip">
        <div *ngIf="isUneditable(trip.id);else other_content">{{trip.end_date}}</div>
        <ng-template #other_content>
          <mat-form-field class="date-field">
            <input matInput [matDatepicker]="picker2" [min] = "startDate.value" [formControl]="endDate">
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2 ></mat-datepicker>
          </mat-form-field>
        </ng-template>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="action">
      <mat-header-cell *matHeaderCellDef></mat-header-cell>
      <mat-cell *matCellDef="let trip">
        <div *ngIf="trip.admin == '*'">
          <div *ngIf="isAvailableToEdit(trip.id)">
            <div *ngIf="isUneditable(trip.id);else other_content">
              <button class='inner-button' mat-icon-button matSuffix (click)="handleElement(trip);$event.stopPropagation()">
                <mat-icon>create</mat-icon>
              </button>
            </div>
            <ng-template #other_content>
              <button mat-icon-button matSuffix (click)="trip=commitChanges(trip);$event.stopPropagation()">
                <mat-icon>done</mat-icon>
              </button>
              <button mat-icon-button matSuffix (click)="cancelChanges(trip.id);$event.stopPropagation()">
                <mat-icon>clear</mat-icon>
              </button>
            </ng-template>
          </div>
        </div>
    </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row [className]="current_editable == null ? 'active-row' : 'disabled-row'" (click)="current_editable == null ? redirectToTripDetail(row.id) : null" *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>
</mat-card>
